{
  "name": "GAStienDBtoCSV",
  "rule": "def f = File.createTempFile('stienGoogleContacts','.csv')\nf.withWriter('UTF-8') { w ->\n\t// def sw = new StringWriter()\n\tdef b = new CSVWriter(w) {\n\t\t'Name' { it.Name }\n\t\t'Given Name' { it['Given Name'] }\n\t\t'Additional Name' { it['Additional Name'] }\n\t\t'Family Name' { it['Family Name'] }\n\t\t'Yomi Name' { it['Yomi Name'] }\n\t\t'Given Name Yomi' { it['Given Name Yomi'] }\n\t\t'Additional Name Yomi' { it['Additional Name Yomi'] }\n\t\t'Family Name Yomi' { it['Family Name Yomi'] }\n\t\t'Name Prefix' { it['Name Prefix'] }\n\t\t'Name Suffix' { it['Name Suffix'] }\n\t\t'Initials' { it['Initials'] }\n\t\t'Nickname' { it['Nickname'] }\n\t\t'Short Name' { it['Short Name'] }\n\t\t'Maiden Name' { it['Maiden Name'] }\n\t\t'Birthday' { it['Birthday'] }\n\t\t'Gender' { it['Gender'] }\n\t\t'Location' { it['Location'] }\n\t\t'Billing Information' { it['Billing Information'] }\n\t\t'Directory Server' { it['Directory Server'] }\n\t\t'Mileage' { it['Mileage'] }\n\t\t'Occupation' { it['Occupation'] }\n\t\t'Hobby' { it['Hobby'] }\n\t\t'Sensitivity' { it['Sensitivity'] },\n\t\t\t'Priority' { it['Priority'] }\n\t\t'Subject' { it['Subject'] }\n\t\t'Notes' { it['Notes'] }\n\t\t'Group Membership' { it['Group Membership'] }\n\t\t'E-mail 1 - Type' { it['E-mail 1 - Type'] }\n\t\t'E-mail 1 - Value' { it['E-mail 1 - Value'] }\n\t\t'E-mail 2 - Type' { it['E-mail 2 - Type'] }\n\t\t'E-mail 2 - Value' { it['E-mail 2 - Value'] }\n\t\t'E-mail 3 - Type' { it['E-mail 3 - Type'] }\n\t\t'E-mail 3 - Value' { it['E-mail 3 - Value'] }\n\t\t'E-mail 4 - Type' { it['E-mail 4 - Type'] }\n\t\t'E-mail 4 - Value' { it['E-mail 4 - Value'] }\n\t\t'Phone 1 - Type' { it['Phone 1 - Type'] }\n\t\t'Phone 1 - Value' { it['Phone 1 - Value'] }\n\t\t'Phone 2 - Type' { it['Phone 2 - Type'] }\n\t\t'Phone 2 - Value' { it['Phone 2 - Value'] }\n\t\t'Address 1 - Type' { it['Address 1 - Type'] }\n\t\t'Address 1 - Formatted' { it['Address 1 - Formatted'] }\n\t\t'Address 1 - Street' { it['Address 1 - Street'] }\n\t\t'Address 1 - City' { it['Address 1 - City'] }\n\t\t'Address 1 - PO Box' { it['Address 1 - PO Box'] }\n\t\t'Address 1 - Region' { it['Address 1 - Region'] }\n\t\t'Address 1 - Postal Code' { it['Address 1 - Postal Code'] }\n\t\t'Address 1 - Country' { it['Address 1 - Country'] }\n\t\t'Address 1 - Extended Address' { it['Address 1 - Extended Address'] }\n\t\t'Address 2 - Type' { it['Address 2 - Type'] }\n\t\t'Address 2 - Formatted' { it['Address 2 - Formatted'] }\n\t\t'Address 2 - Street' { it['Address 2 - Street'] }\n\t\t'Address 2 - City' { it['Address 2 - City'] }\n\t\t'Address 2 - PO Box' { it['Address 2 - PO Box'] }\n\t\t'Address 2 - Region' { it['Address 2 - Region'] }\n\t\t'Address 2 - Postal Code' { it['Address 2 - Postal Code'] }\n\t\t'Address 2 - Country' { it['Address 2 - Country'] }\n\t\t'Address 2 - Extended Address' { it['Address 2 - Extended Address'] }\n\t\t'Custom Field 1 - Type' { it['Custom Field 1 - Type'] }\n\t\t'Custom Field 1 - Value' { it['Custom Field 1 - Value'] }\n\t\t'Custom Field 2 - Type' { it['Custom Field 2 - Type'] }\n\t\t'Custom Field 2 - Value' { it['Custom Field 2 - Value'] }\n\t\t'Custom Field 3 - Type' { it['Custom Field 3 - Type'] }\n\t\t'Custom Field 3 - Value' { it['Custom Field 3 - Value'] }\n\t\t'Custom Field 4 - Type' { it['Custom Field 4 - Type'] }\n\t\t'Custom Field 4 - Value' { it['Custom Field 4 - Value'] }\n\t\t'Custom Field 5 - Type' { it['Custom Field 5 - Type'] }\n\t\t'Custom Field 5 - Value' { it['Custom Field 5 - Value'] }\n\t\t'Custom Field 6 - Type' { it['Custom Field 6 - Type'] }\n\t\t'Custom Field 6 - Value' { it['Custom Field 6 - Value'] }\n\t\t'Custom Field 7 - Type' { it['Custom Field 7 - Type'] }\n\t\t'Custom Field 7 - Value' { it['Custom Field 7 - Value'] }\n\t}\n\tsql.eachRow(\"\"\" \nSELECT \n`Name`,\n`Given Name`,\n`Additional Name`,\n`Family Name`,\n`Yomi Name`,\n`Given Name Yomi`,\n`Additional Name Yomi`,\n`Family Name Yomi`,\n`Name Prefix`,\n`Name Suffix`,\n`Initials`,\n`Nickname`,\n`Short Name`,\n`Maiden Name`,\nDATE_FORMAT(`Birthday`,'%Y-%m-%d') AS `Birthday`,\n`Gender`,\n`Location`,\n`Billing Information`,\n`Directory Server`,\n`Mileage`,\n`Occupation`,\n`Hobby`,\n`Sensitivity`,\n`Priority`,\n`Subject`,\n`Notes`,\nCONCAT_WS('',`Custom Field 1 - Value`,`Group Membership`) AS `Group Membership`,\n`E-mail 1 - Type`,\n`E-mail 1 - Value`,\n`E-mail 2 - Type`,\n`E-mail 2 - Value`,\n`E-mail 3 - Type`,\n`E-mail 3 - Value`,\n`E-mail 4 - Type`,\n`E-mail 4 - Value`,\n`Phone 1 - Type`,\n`Phone 1 - Value`,\n`Phone 2 - Type`,\n`Phone 2 - Value`,\nIF(LENGTH(`Address 1 - Street`) < 1,'','* Voter Registration') AS `Address 1 - Type`,\nIF(LENGTH(`Address 1 - Street`) < 1,'',CONCAT_WS(', ',`Address 1 - Street`,`Address 1 - City`,`Address 1 - Region`,`Address 1 - Postal Code`)) AS `Address 1 - Formatted`,\n`Address 1 - Street`,\n`Address 1 - City`,\n`Address 1 - PO Box`,\n`Address 1 - Region`,\n`Address 1 - Postal Code`,\n`Address 1 - Country`,\n`Address 1 - Extended Address`,\nIF(LENGTH(`Address 2 - Street`) < 1,'','* Voter Registration Mailing') AS `Address 2 - Type`,\nIF(LENGTH(`Address 2 - Street`) < 1,'',CONCAT_WS(', ',`Address 2 - Street`,`Address 2 - City`,`Address 2 - Region`,`Address 2 - Postal Code`)) AS `Address 2 - Formatted`,\n`Address 2 - Street`,\n`Address 2 - City`,\n`Address 2 - PO Box`,\n`Address 2 - Region`,\n`Address 2 - Postal Code`,\n`Address 2 - Country`,\n`Address 2 - Extended Address`,\n`Custom Field 1 - Type`,\n`Custom Field 1 - Value`,\n`Custom Field 2 - Type`,\n`Custom Field 2 - Value`,\n`Custom Field 3 - Type`,\n`Custom Field 3 - Value`,\n'Voter Registration Name' AS `Custom Field 4 - Type`,\n`Name` AS `Custom Field 4 - Value`,\n`Custom Field 5 - Type`,\n`Custom Field 5 - Value`,\n`Custom Field 6 - Type`,\n`Custom Field 6 - Value`,\n`Custom Field 7 - Type`,\nDATE_FORMAT(`Custom Field 7 - Value`,'%Y-%m-%d') AS `Custom Field 7 - Value`\nFROM (\nSELECT \nIF(LENGTH(`Name Suffix`) > 0,CONCAT_WS(', ',CONCAT_WS(' ',`Given Name`,`Additional Name`,`Family Name`),`Name Suffix`) ,CONCAT_WS(' ',`Given Name`,`Additional Name`,`Family Name`)) AS Name,\n`Given Name`,\n`Additional Name`,\n`Family Name`,\n'' AS `Yomi Name`,\n'' AS `Given Name Yomi`,\n'' AS `Additional Name Yomi`,\n'' AS `Family Name Yomi`,\n`Name Prefix`,\n`Name Suffix`,\n'' AS `Initials`,\n'' AS `Nickname`,\n'' AS `Short Name`,\n'' AS `Maiden Name`,\n`Birthday`,\n`Gender2` AS `Gender`,\n'' AS `Location`,\n'' AS `Billing Information`,\n'' AS `Directory Server`,\n'' AS `Mileage`,\n'' AS `Occupation`,\n'' AS `Hobby`,\n'' AS `Sensitivity`,\n'' AS `Priority`,\n'' AS `Subject`,\n'' AS `Notes`,\nCONCAT(' Voter Data ::: *My Contacts ::: ',`County`,' - ',`Address 1 - City`,' Voters ::: CongressionalDistrict ',`Congressional District`,' ::: SenateDistrict ',`Senate District`,' ::: HouseDistrict ',`House District`,' ::: JudicialDistrict ',`Judicial District`) AS `Group Membership`,\nIF(`E-mail 1 - Value` IS NULL,'','* Other') AS `E-mail 1 - Type`,\nIF(`E-mail 1 - Value` IS NULL,'',`E-mail 1 - Value`) AS `E-mail 1 - Value`,\nIF(`E-mail 2 - Value` IS NULL,'','* Other') AS `E-mail 2 - Type`,\nIF(`E-mail 2 - Value` IS NULL,'',`E-mail 2 - Value`) AS `E-mail 2 - Value`,\nIF(`E-mail 3 - Value` IS NULL,'','* Other') AS `E-mail 3 - Type`,\nIF(`E-mail 3 - Value` IS NULL,'',`E-mail 3 - Value`) AS `E-mail 3 - Value`,\nIF(`E-mail 4 - Value` IS NULL,'','* Other') AS `E-mail 4 - Type`,\nIF(`E-mail 4 - Value` IS NULL,'',`E-mail 4 - Value`) AS `E-mail 4 - Value`,\nIF(`Phone 1 - Value` IS NULL,'','Home') AS `Phone 1 - Type`,\nIF(`Phone 1 - Value` IS NULL,'',`Phone 1 - Value`) AS `Phone 1 - Value`,\nIF(`Phone 2 - Value` IS NULL,'','Work') AS `Phone 2 - Type`,\nIF(`Phone 2 - Value` IS NULL,'',`Phone 2 - Value`) AS `Phone 2 - Value`,\n`Address 1 - Street`,\n`Address 1 - City`,\n'' AS `Address 1 - PO Box`,\n`Address 1 - Region`,\n`Address 1 - Postal Code`,\n'' AS `Address 1 - Country`,\n'' AS `Address 1 - Extended Address`,\n`Address 2 - Street`,\n`Address 2 - City`,\n'' AS `Address 2 - PO Box`,\n`Address 2 - Region`,\n`Address 2 - Postal Code`,\n'' AS `Address 2 - Country`,\n'' AS `Address 2 - Extended Address`,\n'County' AS `Custom Field 1 - Type`,\n`County` AS `Custom Field 1 - Value`,\n'Voter ID' AS `Custom Field 2 - Type`,\n`Voter ID` AS `Custom Field 2 - Value`,\nIF(LENGTH(`Party Last Voted`) < 1,'','Party Last Voted') AS `Custom Field 3 - Type`,\nIF(LENGTH(`Party Last Voted`) < 1,'',`Party Last Voted`) AS `Custom Field 3 - Value`,\nIF(LENGTH(`Custom Field 5 - Value`) < 1,'','Race') AS `Custom Field 5 - Type`,\nIF(LENGTH(`Custom Field 5 - Value`) < 1,'',`Custom Field 5 - Value`) AS `Custom Field 5 - Value`,\nIF(LENGTH(`Custom Field 6 - Value`) < 1,'','VoterStatus') AS `Custom Field 6 - Type`,\nIF(LENGTH(`Custom Field 6 - Value`) < 1,'',`Custom Field 6 - Value`) AS `Custom Field 6 - Value`,\nIF(LENGTH(`Custom Field 7 - Value`) < 1,'','RegistrationDate') AS `Custom Field 7 - Type`,\nIF(LENGTH(`Custom Field 7 - Value`) < 1,'',`Custom Field 7 - Value`) AS `Custom Field 7 - Value`\nFROM (\nSELECT \nproper(VoterFirstName) AS `Given Name`,\nIF(LENGTH(VoterMiddleMaiden) = 1,UPPER(VoterMiddleMaiden),proper(VoterMiddleMaiden)) AS `Additional Name`,\nproper(VoterLastName) AS `Family Name`,\nproper(VoterNameTitle) AS `Name Prefix`,\nIF(LEFT(VoterNameSuffix,1) = 'I',VoterNameSuffix,proper(VoterNameSuffix)) AS`Name Suffix`,\nDateOfBirth AS `BirthDay`,\nGender AS Gender2,\n(SELECT cc.`County Description` FROM `County Codes` cc WHERE vtr.CountyCode = cc.`County Code` LIMIT 1) AS `County`,\nCongressionalDistrict AS `Congressional District`,\nSenateDistrict AS `Senate District`,\nHouseDistrict  AS `House District`,\nJudicialDistrict AS `Judicial District`,\n(SELECT LOWER(s.email1) FROM stiendonors2013 s WHERE s.nationbuilder_id = vtr.id) AS `E-mail 1 - Value`,\n(SELECT LOWER(s.email2) FROM stiendonors2013 s WHERE s.nationbuilder_id = vtr.id) AS `E-mail 2 - Value`,\n(SELECT LOWER(s.email3) FROM stiendonors2013 s WHERE s.nationbuilder_id = vtr.id) AS `E-mail 3 - Value`,\n(SELECT LOWER(s.email4) FROM stiendonors2013 s WHERE s.nationbuilder_id = vtr.id) AS `E-mail 4 - Value`,\n(SELECT LOWER(s.phone_number) FROM stiendonors2013 s WHERE s.nationbuilder_id = vtr.id) AS `Phone 1 - Value`,\n(SELECT LOWER(s.work_phone_number) FROM stiendonors2013 s WHERE s.nationbuilder_id = vtr.id) AS `Phone 2 - Value`,\nTRIM(CONCAT_WS(' ',ResHouseNbr,proper(ResStreetName),TRIM(CONCAT_WS(' ',ResStreetSuffix,ResAptUnitNbr)))) AS `Address 1 - Street`,\nproper(ResCityName) AS `Address 1 - City`,\n'GA' AS `Address 1 - Region`,\nIF(LENGTH(ResZipPlus4) < 1,ResZip,CONCAT_WS('-',ResZip,ResZipPlus4)) AS `Address 1 - Postal Code`,\nTRIM(CONCAT_WS(' ',MailHouseNbr,proper(MailStreetName),TRIM(CONCAT_WS(' ',MailStreetSuffix,MailAptUnitNbr)))) AS `Address 2 - Street`,\nproper(MailCity) AS `Address 2 - City`,\nMailState AS `Address 2 - Region`,\nIF(LENGTH(MailZipPlus4) < 1,MailZip,CONCAT_WS('-',MailZip,MailZipPlus4)) AS `Address 2 - Postal Code`,\nRegistrationNbr AS `Voter ID`,\nCASE \nWHEN PartyLastVoted = 'D' THEN 'Democrat'\nWHEN PartyLastVoted = 'R' THEN 'Republican'\nWHEN PartyLastVoted = 'I' THEN 'Independent'\nELSE 'Independent'\nEND AS `Party Last Voted`,\nCASE \nWHEN Race = 'W' THEN 'White'\nWHEN Race = 'B' THEN 'Black'\nWHEN Race = 'A' THEN 'Black'\nWHEN Race = 'H' THEN 'Hispanic'\nWHEN Race = 'O' THEN 'Other'\nWHEN Race = 'U' THEN 'Unknown'\nELSE 'Unknown'\nEND AS `Custom Field 5 - Value`,\nCASE\nWHEN VoterStatus = 'A' THEN 'Active'\nWHEN VoterStatus = 'I' THEN 'Inactive'\nELSE 'Inactive'\nEND AS `Custom Field 6 - Value`,\nRegistrationDate AS `Custom Field 7 - Value`\nFROM (\nSELECT vt.*,m.id FROM Voters vt\nJOIN (\nSELECT v.RegistrationNbr,MAX(v.ExportDate) AS ExportDate\nFROM Voters v GROUP BY v.RegistrationNbr\n) AS mv ON vt.RegistrationNbr = mv.RegistrationNbr AND vt.ExportDate = mv.ExportDate\nJOIN Matched AS m ON m.RegistrationNbr = vt.RegistrationNbr\n) AS vtr\n) AS vtr2\n) AS vtr3\n\"\"\") { r ->\n\t\tb << r\n\t}\n}\nreturn [\n\t[ csv: f.name]\n]\n",
  "class": "edu.usf.RuleChains.Groovy"
}