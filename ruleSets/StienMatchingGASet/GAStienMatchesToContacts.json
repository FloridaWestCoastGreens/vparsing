{
  "name": "GAStienMatchesToContacts",
  "rule": "INSERT INTO StienGoogleContactMatches\nSELECT \n`Name`,\n`Given Name`,\n`Additional Name`,\n`Family Name`,\n`Yomi Name`,\n`Given Name Yomi`,\n`Additional Name Yomi`,\n`Family Name Yomi`,\n`Name Prefix`,\n`Name Suffix`,\n`Initials`,\n`Nickname`,\n`Short Name`,\n`Maiden Name`,\nDATE_FORMAT(`Birthday`,'%Y-%m-%d') AS `Birthday`,\n`Gender`,\n`Location`,\n`Billing Information`,\n`Directory Server`,\n`Mileage`,\n`Occupation`,\n`Hobby`,\n`Sensitivity`,\n`Priority`,\n`Subject`,\n`Notes`,\nCONCAT_WS('',`Custom Field 1 - Value`,`Group Membership`) AS `Group Membership`,\n`E-mail 1 - Type`,\n`E-mail 1 - Value`,\n`E-mail 2 - Type`,\n`E-mail 2 - Value`,\n`E-mail 3 - Type`,\n`E-mail 3 - Value`,\n`E-mail 4 - Type`,\n`E-mail 4 - Value`,\n`Phone 1 - Type`,\n`Phone 1 - Value`,\n`Phone 2 - Type`,\n`Phone 2 - Value`,\nIF(LENGTH(`Address 1 - Street`) < 1,'','* Voter Registration') AS `Address 1 - Type`,\nIF(LENGTH(`Address 1 - Street`) < 1,'',CONCAT_WS(', ',`Address 1 - Street`,`Address 1 - City`,`Address 1 - Region`,`Address 1 - Postal Code`)) AS `Address 1 - Formatted`,\n`Address 1 - Street`,\n`Address 1 - City`,\n`Address 1 - PO Box`,\n`Address 1 - Region`,\n`Address 1 - Postal Code`,\n`Address 1 - Country`,\n`Address 1 - Extended Address`,\nIF(LENGTH(`Address 2 - Street`) < 1,'','* Voter Registration Mailing') AS `Address 2 - Type`,\nIF(LENGTH(`Address 2 - Street`) < 1,'',CONCAT_WS(', ',`Address 2 - Street`,`Address 2 - City`,`Address 2 - Region`,`Address 2 - Postal Code`)) AS `Address 2 - Formatted`,\n`Address 2 - Street`,\n`Address 2 - City`,\n`Address 2 - PO Box`,\n`Address 2 - Region`,\n`Address 2 - Postal Code`,\n`Address 2 - Country`,\n`Address 2 - Extended Address`,\n`Custom Field 1 - Type`,\n`Custom Field 1 - Value`,\n`Custom Field 2 - Type`,\n`Custom Field 2 - Value`,\n`Custom Field 3 - Type`,\n`Custom Field 3 - Value`,\n'Voter Registration Name' AS `Custom Field 4 - Type`,\n`Name` AS `Custom Field 4 - Value`,\n`Custom Field 5 - Type`,\n`Custom Field 5 - Value`,\n`Custom Field 6 - Type`,\n`Custom Field 6 - Value`,\n`Custom Field 7 - Type`,\nDATE_FORMAT(`Custom Field 7 - Value`,'%Y-%m-%d') AS `Custom Field 7 - Value`,\n`Custom Field 8 - Type`,\nDATE_FORMAT(`Custom Field 8 - Value`,'%Y-%m-%d') AS `Custom Field 8 - Value`\nFROM (\n\tSELECT \n\tIF(LENGTH(`Name Suffix`) > 0,CONCAT_WS(', ',CONCAT_WS(' ',`Given Name`,`Additional Name`,`Family Name`),`Name Suffix`) ,CONCAT_WS(' ',`Given Name`,`Additional Name`,`Family Name`)) AS Name,\n\t`Given Name`,\n\t`Additional Name`,\n\t`Family Name`,\n\t'' AS `Yomi Name`,\n\t'' AS `Given Name Yomi`,\n\t'' AS `Additional Name Yomi`,\n\t'' AS `Family Name Yomi`,\n\t`Name Prefix`,\n\t`Name Suffix`,\n\t'' AS `Initials`,\n\t'' AS `Nickname`,\n\t'' AS `Short Name`,\n\t'' AS `Maiden Name`,\n\t`Birthday`,\n\t`Gender2` AS `Gender`,\n\t'' AS `Location`,\n\t'' AS `Billing Information`,\n\t'' AS `Directory Server`,\n\t'' AS `Mileage`,\n\t'' AS `Occupation`,\n\t'' AS `Hobby`,\n\t'' AS `Sensitivity`,\n\t'' AS `Priority`,\n\t'' AS `Subject`,\n\t'' AS `Notes`,\n\tCONCAT(' Voter Data ::: *My Contacts ::: ',`County`,' - ',`Address 1 - City`,' Voters ::: CongressionalDistrict ',`Congressional District`,' ::: SenateDistrict ',`Senate District`,' ::: HouseDistrict ',`House District`,' ::: JudicialDistrict ',`Judicial District`) AS `Group Membership`,\n\tIF(`E-mail 1 - Value` IS NULL,'','* Other') AS `E-mail 1 - Type`,\n\tIF(`E-mail 1 - Value` IS NULL,'',`E-mail 1 - Value`) AS `E-mail 1 - Value`,\n\tIF(`E-mail 2 - Value` IS NULL,'','* Other') AS `E-mail 2 - Type`,\n\tIF(`E-mail 2 - Value` IS NULL,'',`E-mail 2 - Value`) AS `E-mail 2 - Value`,\n\tIF(`E-mail 3 - Value` IS NULL,'','* Other') AS `E-mail 3 - Type`,\n\tIF(`E-mail 3 - Value` IS NULL,'',`E-mail 3 - Value`) AS `E-mail 3 - Value`,\n\tIF(`E-mail 4 - Value` IS NULL,'','* Other') AS `E-mail 4 - Type`,\n\tIF(`E-mail 4 - Value` IS NULL,'',`E-mail 4 - Value`) AS `E-mail 4 - Value`,\n\tIF(`Phone 1 - Value` IS NULL,'','Home') AS `Phone 1 - Type`,\n\tIF(`Phone 1 - Value` IS NULL,'',`Phone 1 - Value`) AS `Phone 1 - Value`,\n\tIF(`Phone 2 - Value` IS NULL,'','Work') AS `Phone 2 - Type`,\n\tIF(`Phone 2 - Value` IS NULL,'',`Phone 2 - Value`) AS `Phone 2 - Value`,\n\t`Address 1 - Street`,\n\t`Address 1 - City`,\n\t'' AS `Address 1 - PO Box`,\n\t`Address 1 - Region`,\n\t`Address 1 - Postal Code`,\n\t'' AS `Address 1 - Country`,\n\t'' AS `Address 1 - Extended Address`,\n\t`Address 2 - Street`,\n\t`Address 2 - City`,\n\t'' AS `Address 2 - PO Box`,\n\t`Address 2 - Region`,\n\t`Address 2 - Postal Code`,\n\t'' AS `Address 2 - Country`,\n\t'' AS `Address 2 - Extended Address`,\n\t'County' AS `Custom Field 1 - Type`,\n\t`County` AS `Custom Field 1 - Value`,\n\t'Voter ID' AS `Custom Field 2 - Type`,\n\t`Voter ID` AS `Custom Field 2 - Value`,\n\tIF(LENGTH(`Party Last Voted`) < 1,'','Party Last Voted') AS `Custom Field 3 - Type`,\n\tIF(LENGTH(`Party Last Voted`) < 1,'',`Party Last Voted`) AS `Custom Field 3 - Value`,\n\tIF(LENGTH(`Custom Field 5 - Value`) < 1,'','Race') AS `Custom Field 5 - Type`,\n\tIF(LENGTH(`Custom Field 5 - Value`) < 1,'',`Custom Field 5 - Value`) AS `Custom Field 5 - Value`,\n\tIF(LENGTH(`Custom Field 6 - Value`) < 1,'','VoterStatus') AS `Custom Field 6 - Type`,\n\tIF(LENGTH(`Custom Field 6 - Value`) < 1,'',`Custom Field 6 - Value`) AS `Custom Field 6 - Value`,\n\tIF(LENGTH(`Custom Field 7 - Value`) < 1,'','RegistrationDate') AS `Custom Field 7 - Type`,\n\tIF(LENGTH(`Custom Field 7 - Value`) < 1,'',`Custom Field 7 - Value`) AS `Custom Field 7 - Value`,\n\tIF(LENGTH(`Custom Field 8 - Value`) < 1,'','Last Updated') AS `Custom Field 8 - Type`,\n\tIF(LENGTH(`Custom Field 8 - Value`) < 1,'',`Custom Field 8 - Value`) AS `Custom Field 8 - Value`\n\tFROM (\n\t\tSELECT \n\t\tproper(VoterFirstName) AS `Given Name`,\n\t\tIF(LENGTH(VoterMiddleMaiden) = 1,UPPER(VoterMiddleMaiden),proper(VoterMiddleMaiden)) AS `Additional Name`,\n\t\tproper(VoterLastName) AS `Family Name`,\n\t\tproper(VoterNameTitle) AS `Name Prefix`,\n\t\tIF(LEFT(VoterNameSuffix,1) = 'I',VoterNameSuffix,proper(VoterNameSuffix)) AS`Name Suffix`,\n\t\tDateOfBirth AS `BirthDay`,\n\t\tGender AS Gender2,\n\t\t(SELECT cc.`County Description` FROM `County Codes` cc WHERE vtr.CountyCode = cc.`County Code` LIMIT 1) AS `County`,\n\t\tCongressionalDistrict AS `Congressional District`,\n\t\tSenateDistrict AS `Senate District`,\n\t\tHouseDistrict  AS `House District`,\n\t\tJudicialDistrict AS `Judicial District`,\n\t\t(SELECT LOWER(s.email1) FROM stiendonors2013 s WHERE s.nationbuilder_id = vtr.id) AS `E-mail 1 - Value`,\n\t\t(SELECT LOWER(s.email2) FROM stiendonors2013 s WHERE s.nationbuilder_id = vtr.id) AS `E-mail 2 - Value`,\n\t\t(SELECT LOWER(s.email3) FROM stiendonors2013 s WHERE s.nationbuilder_id = vtr.id) AS `E-mail 3 - Value`,\n\t\t(SELECT LOWER(s.email4) FROM stiendonors2013 s WHERE s.nationbuilder_id = vtr.id) AS `E-mail 4 - Value`,\n\t\t(SELECT LOWER(s.phone_number) FROM stiendonors2013 s WHERE s.nationbuilder_id = vtr.id) AS `Phone 1 - Value`,\n\t\t(SELECT LOWER(s.work_phone_number) FROM stiendonors2013 s WHERE s.nationbuilder_id = vtr.id) AS `Phone 2 - Value`,\n\t\tTRIM(CONCAT_WS(' ',ResHouseNbr,proper(ResStreetName),TRIM(CONCAT_WS(' ',ResStreetSuffix,ResAptUnitNbr)))) AS `Address 1 - Street`,\n\t\tproper(ResCityName) AS `Address 1 - City`,\n\t\t'GA' AS `Address 1 - Region`,\n\t\tIF(LENGTH(ResZipPlus4) < 1,ResZip,CONCAT_WS('-',ResZip,ResZipPlus4)) AS `Address 1 - Postal Code`,\n\t\tTRIM(CONCAT_WS(' ',MailHouseNbr,proper(MailStreetName),TRIM(CONCAT_WS(' ',MailStreetSuffix,MailAptUnitNbr)))) AS `Address 2 - Street`,\n\t\tproper(MailCity) AS `Address 2 - City`,\n\t\tMailState AS `Address 2 - Region`,\n\t\tIF(LENGTH(MailZipPlus4) < 1,MailZip,CONCAT_WS('-',MailZip,MailZipPlus4)) AS `Address 2 - Postal Code`,\n\t\tRegistrationNbr AS `Voter ID`,\n\t\tCASE \n\t\tWHEN PartyLastVoted = 'D' THEN 'Democrat'\n\t\tWHEN PartyLastVoted = 'R' THEN 'Republican'\n\t\tWHEN PartyLastVoted = 'I' THEN 'Independent'\n\t\tELSE 'Independent'\n\t\tEND AS `Party Last Voted`,\n\t\tCASE \n\t\tWHEN Race = 'W' THEN 'White'\n\t\tWHEN Race = 'B' THEN 'Black'\n\t\tWHEN Race = 'A' THEN 'Black'\n\t\tWHEN Race = 'H' THEN 'Hispanic'\n\t\tWHEN Race = 'O' THEN 'Other'\n\t\tWHEN Race = 'U' THEN 'Unknown'\n\t\tELSE 'Unknown'\n\t\tEND AS `Custom Field 5 - Value`,\n\t\tCASE\n\t\tWHEN VoterStatus = 'A' THEN 'Active'\n\t\tWHEN VoterStatus = 'I' THEN 'Inactive'\n\t\tELSE 'Inactive'\n\t\tEND AS `Custom Field 6 - Value`,\n\t\tRegistrationDate AS `Custom Field 7 - Value`,\n\t\tExportDate AS `Custom Field 8 - Value`\n\t\tFROM (\n\t\t\tSELECT vt.*,m.id FROM Voters vt\n\t\t\tJOIN (\n\t\t\t\tSELECT v.RegistrationNbr,MAX(v.ExportDate) AS ExportDate\n\t\t\t\tFROM Voters v GROUP BY v.RegistrationNbr\n\t\t\t) AS mv ON vt.RegistrationNbr = mv.RegistrationNbr AND vt.ExportDate = mv.ExportDate\n\t\t\tJOIN Matched AS m ON m.RegistrationNbr = vt.RegistrationNbr\n\t\t) AS vtr\n\t) AS vtr2\n) AS vtr3",
  "class": "edu.usf.RuleChains.SQLQuery"
}