{
  "name": "FLVotersZipMerge2",
  "rule": "def settings = [\n\timportFolder: '/usr/share/tomcat/Voters/Florida',\n\timportFolderMac: '/Applications/NetBeans/apache-tomcat-7.0.41/Voters/Florida'\n]\ndef tempfiles = []\ndef filecount = 0\ndef ln = System.getProperty('line.separator')\nnew File(settings.importFolder).eachDirRecurse() { dir ->\n\tdir.eachFileMatch(~/.*.zip/) { file -> \n\t\t\n\t\tdef count = 0\n\t\tdef unparsedTextFile\n\t\tsql.withBatch(20, \"\"\"INSERT INTO \"Florida\".\"Voters\" (\n\"county_code\",\n\"voter_id\",\n\"name_last\",\n\"name_suffix\",\n\"name_first\",\n\"name_middle\",\n\"suppress_address\",\n\"residence_address_line_1\",\n\"residence_address_line_2\",\n\"residence_city\",\n\"residence_state\",\n\"residence_zipcode\",\n\"mailing_address_line_1\",\n\"mailing_address_line_2\",\n\"mailing_address_line_3\",\n\"mailing_city\",\n\"mailing_state\",\n\"mailing_zipcode\",\n\"mailing_country\",\n\"gender\",\n\"race\",\n\"birth_date\",\n\"registration_date\",\n\"party_affiliation\",\n\"precinct\",\n\"precinct_group\",\n\"precinct_split\",\n\"precinct_suffix\",\n\"voter_status\",\n\"congressional_district\",\n\"house_district\",\n\"senate_district\",\n\"county_commission_district\",\n\"school_board_district\",\n\"daytime_area_code\",\n\"daytime_phone_number\",\n\"daytime_phone_extension\",\n\"export_date\"\n) VALUES (\n:county_code,\n:voter_id,\n:name_last,\n:name_suffix,\n:name_first,\n:name_middle,\n:suppress_address,\n:residence_address_line_1,\n:residence_address_line_2,\n:residence_city,\n:residence_state,\n:residence_zipcode,\n:mailing_address_line_1,\n:mailing_address_line_2,\n:mailing_address_line_3,\n:mailing_city,\n:mailing_state,\n:mailing_zipcode,\n:mailing_country,\n:gender,\n:race,\nto_date(:birth_date, 'MM/DD/YYYY'),\nto_date(:registration_date, 'MM/DD/YYYY'),\n:party_affiliation,\n:precinct,\n:precinct_group,\n:precinct_split,\n:precinct_suffix,\n:voter_status,\n:congressional_district,\n:house_district,\n:senate_district,\n:county_commission_district,\n:school_board_district,\n:daytime_area_code,\n:daytime_phone_number,\n:daytime_phone_extension,\nto_date(:export_date, 'YYYYMMDD')\n) \"\"\") { ps ->             \n\t\t\t//to_date(:DateOfBirth, 'MM/DD/YYYY'),%m/%d/%Y\n\t\t\tdef zipFile = new java.util.zip.ZipFile(file)\n\t\t\tzipFile.entries().each { voterEntry ->\n\t\t\t\tdef modificationTime = (new Date(voterEntry.getTime())).format(\"yyyyMMdd\")\n\t\t\t\tprintln \"${modificationTime} Mod Time\"\n\t\t\t\tprintln \"Entry is ${voterEntry.name}\"\n\t\t\t\tCSVReader reader = new CSVReader((new InputStreamReader(zipFile.getInputStream(voterEntry), \"UTF-8\")) as Reader,'\\t' as char)\n\t\t\t\twhile ((line = reader.readNext()) != null) {\n\t\t\t\t\tdef r = line.collect { it.trim() }\n\t\t\t\t\tps.addBatch([\n\t\t\t\t\t\tcounty_code: r[0],\n\t\t\t\t\t\tvoter_id: r[1],\n\t\t\t\t\t\tname_last: r[2],\n\t\t\t\t\t\tname_suffix: r[3],\n\t\t\t\t\t\tname_first: r[4],\n\t\t\t\t\t\tname_middle: r[5],\n\t\t\t\t\t\tsuppress_address: r[6],\n\t\t\t\t\t\tresidence_address_line_1: r[7],\n\t\t\t\t\t\tresidence_address_line_2: r[8],\n\t\t\t\t\t\tresidence_city: r[9],\n\t\t\t\t\t\tresidence_state: r[10],\n\t\t\t\t\t\tresidence_zipcode: r[11],\n\t\t\t\t\t\tmailing_address_line_1: r[12],\n\t\t\t\t\t\tmailing_address_line_2: r[13],\n\t\t\t\t\t\tmailing_address_line_3: r[14],\n\t\t\t\t\t\tmailing_city: r[15],\n\t\t\t\t\t\tmailing_state: r[16],\n\t\t\t\t\t\tmailing_zipcode: r[17],\n\t\t\t\t\t\tmailing_country: r[18],\n\t\t\t\t\t\tgender: r[19],\n\t\t\t\t\t\trace: r[20],\n\t\t\t\t\t\tbirth_date: r[21],\n\t\t\t\t\t\tregistration_date: r[22],\n\t\t\t\t\t\tparty_affiliation: r[23],\n\t\t\t\t\t\tprecinct: r[24],\n\t\t\t\t\t\tprecinct_group: r[25],\n\t\t\t\t\t\tprecinct_split: r[26],\n\t\t\t\t\t\tprecinct_suffix: r[27],\n\t\t\t\t\t\tvoter_status: r[28],\n\t\t\t\t\t\tcongressional_district: r[29],\n\t\t\t\t\t\thouse_district: r[30],\n\t\t\t\t\t\tsenate_district: r[31],\n\t\t\t\t\t\tcounty_commission_district: r[32],\n\t\t\t\t\t\tschool_board_district: r[33],\n\t\t\t\t\t\tdaytime_area_code: r[34],\n\t\t\t\t\t\tdaytime_phone_number: r[35],\n\t\t\t\t\t\tdaytime_phone_extension: r[36],\n\t\t\t\t\t\texport_date: modificationTime\t\t\t\t\t\n\t\t\t\t\t])\n\t\t\t\t}\t\t\t\t\n\t\t\t}\t\t\t\t\t\t\t\t\t\n\t\t}\t\t\n\t\t\n\t\t\n\t\t\n\t}\n}\t\n\n",
  "class": "edu.usf.RuleChains.Groovy"
}