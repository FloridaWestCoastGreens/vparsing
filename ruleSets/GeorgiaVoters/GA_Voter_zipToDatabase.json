{
  "name": "GA_Voter_zipToDatabase",
  "rule": "def settings = [\n\timportFolder: '/usr/share/tomcat/Voters/Georgia',\n\tzipName: \"Georgia_Voters_Fixed.zip\",\n\tcompressedFile: 'DailyVoterBase_Fixed.txt'\n]\ndef zipFile = new java.util.zip.ZipFile(new File(settings.importFolder,settings.zipName))\n\ndef voterEntry = zipFile.entries().findAll { !it.directory }.find { it.name == settings.compressedFile }\ndef modificationTime = (new Date(voterEntry.getTime())).format(\"yyyyMMdd\")\nprintln \"${modificationTime} Mod Time\"\nprintln \"Entry is ${voterEntry.name}\"\n\ndef unparsedTextFile = File.createTempFile('temp', '.txt')\nunparsedTextFile.withWriter('unicode'){ w->\n\tdef reader = new BufferedReader(new InputStreamReader(zipFile.getInputStream(voterEntry), \"UTF-8\"))\n\treader.eachLine { line -> \n\t\tw<< line\n\t}\n}\nprintln \"Temp file path: ${unparsedTextFile.canonicalPath}\"\n\ndef importSQL = \"\"\"\nCREATE TEMPORARY TABLE IF NOT EXISTS `VotersTemp` (\n  `CountyCode` varchar(3) COLLATE utf8_unicode_ci NOT NULL,\n  `RegistrationNbr` varchar(8) COLLATE utf8_unicode_ci NOT NULL,\n  `VoterStatus` varchar(1) COLLATE utf8_unicode_ci DEFAULT NULL,\n  `VoterLastName` varchar(20) COLLATE utf8_unicode_ci DEFAULT NULL,\n  `VoterFirstName` varchar(20) COLLATE utf8_unicode_ci DEFAULT NULL,\n  `VoterMiddleMaiden` varchar(20) COLLATE utf8_unicode_ci DEFAULT NULL,\n  `VoterNameSuffix` varchar(3) COLLATE utf8_unicode_ci DEFAULT NULL,\n  `VoterNameTitle` varchar(3) COLLATE utf8_unicode_ci DEFAULT NULL,\n  `ResHouseNbr` varchar(6) COLLATE utf8_unicode_ci DEFAULT NULL,\n  `ResStreetName` varchar(30) COLLATE utf8_unicode_ci DEFAULT NULL,\n  `ResStreetSuffix` varchar(2) COLLATE utf8_unicode_ci DEFAULT NULL,\n  `ResAptUnitNbr` varchar(8) COLLATE utf8_unicode_ci DEFAULT NULL,\n  `ResCityName` varchar(17) COLLATE utf8_unicode_ci DEFAULT NULL,\n  `ResZip` varchar(5) COLLATE utf8_unicode_ci DEFAULT NULL,\n  `ResZipPlus4` varchar(4) COLLATE utf8_unicode_ci DEFAULT NULL,\n  `MidrFlag` varchar(1) COLLATE utf8_unicode_ci DEFAULT NULL,\n  `PollWorker` varchar(1) COLLATE utf8_unicode_ci DEFAULT NULL,\n  `TransactionCode` varchar(1) COLLATE utf8_unicode_ci DEFAULT NULL,\n  `TransactionYearMonth` varchar(6) COLLATE utf8_unicode_ci DEFAULT NULL,\n  `Filler1` varchar(2) COLLATE utf8_unicode_ci DEFAULT NULL,\n  `DateOfBirth` date DEFAULT NULL,\n  `RegistrationDate` date DEFAULT NULL,\n  `Race` varchar(1) COLLATE utf8_unicode_ci DEFAULT NULL,\n  `Gender` varchar(1) COLLATE utf8_unicode_ci DEFAULT NULL,\n  `Absentee` varchar(1) COLLATE utf8_unicode_ci DEFAULT NULL,\n  `LandDistrict` varchar(3) COLLATE utf8_unicode_ci DEFAULT NULL,\n  `LandLot` varchar(4) COLLATE utf8_unicode_ci DEFAULT NULL,\n  `OriginalRegDate` date DEFAULT NULL,\n  `StatusReason` varchar(9) COLLATE utf8_unicode_ci DEFAULT NULL,\n  `Filler2` varchar(5) COLLATE utf8_unicode_ci DEFAULT NULL,\n  `CountyPrecinctId` varchar(5) COLLATE utf8_unicode_ci DEFAULT NULL,\n  `CityPrecinctId` varchar(5) COLLATE utf8_unicode_ci DEFAULT NULL,\n  `CongressionalDistrict` varchar(3) COLLATE utf8_unicode_ci DEFAULT NULL,\n  `SenateDistrict` varchar(3) COLLATE utf8_unicode_ci DEFAULT NULL,\n  `HouseDistrict` varchar(3) COLLATE utf8_unicode_ci DEFAULT NULL,\n  `JudicialDistrict` varchar(3) COLLATE utf8_unicode_ci DEFAULT NULL,\n  `CommDistrict` varchar(3) COLLATE utf8_unicode_ci DEFAULT NULL,\n  `SchoolDistrict` varchar(3) COLLATE utf8_unicode_ci DEFAULT NULL,\n  `CountyDistAName` varchar(13) COLLATE utf8_unicode_ci DEFAULT NULL,\n  `CountyDistAValue` varchar(3) COLLATE utf8_unicode_ci DEFAULT NULL,\n  `CountyDistBName` varchar(13) COLLATE utf8_unicode_ci DEFAULT NULL,\n  `CountyDistBValue` varchar(3) COLLATE utf8_unicode_ci DEFAULT NULL,\n  `MunicipalName` varchar(17) COLLATE utf8_unicode_ci DEFAULT NULL,\n  `MunicipalCode` varchar(3) COLLATE utf8_unicode_ci DEFAULT NULL,\n  `WardCityCouncilName` varchar(13) COLLATE utf8_unicode_ci DEFAULT NULL,\n  `WardCityCouncil` varchar(3) COLLATE utf8_unicode_ci DEFAULT NULL,\n  `CitySchoolDistName` varchar(13) COLLATE utf8_unicode_ci DEFAULT NULL,\n  `CitySchoolDist` varchar(3) COLLATE utf8_unicode_ci DEFAULT NULL,\n  `CityDistAName` varchar(13) COLLATE utf8_unicode_ci DEFAULT NULL,\n  `CityDistAValue` varchar(3) COLLATE utf8_unicode_ci DEFAULT NULL,\n  `CityDistBName` varchar(13) COLLATE utf8_unicode_ci DEFAULT NULL,\n  `CityDistBValue` varchar(3) COLLATE utf8_unicode_ci DEFAULT NULL,\n  `CityDistCName` varchar(13) COLLATE utf8_unicode_ci DEFAULT NULL,\n  `CityDistCValue` varchar(3) COLLATE utf8_unicode_ci DEFAULT NULL,\n  `CityDistDName` varchar(13) COLLATE utf8_unicode_ci DEFAULT NULL,\n  `CityDistDValue` varchar(3) COLLATE utf8_unicode_ci DEFAULT NULL,\n  `DateLastVotedDate` date DEFAULT NULL,\n  `TypeOfElection` varchar(3) COLLATE utf8_unicode_ci DEFAULT NULL,\n  `PartyLastVoted` varchar(1) COLLATE utf8_unicode_ci DEFAULT NULL,\n  `LastContactDate` date DEFAULT NULL,\n  `MailHouseNbr` varchar(6) COLLATE utf8_unicode_ci DEFAULT NULL,\n  `MailStreetName` varchar(30) COLLATE utf8_unicode_ci DEFAULT NULL,\n  `MailStreetSuffix` varchar(2) COLLATE utf8_unicode_ci DEFAULT NULL,\n  `MailAptUnitNbr` varchar(8) COLLATE utf8_unicode_ci DEFAULT NULL,\n  `MailCity` varchar(17) COLLATE utf8_unicode_ci DEFAULT NULL,\n  `MailState` varchar(2) COLLATE utf8_unicode_ci DEFAULT NULL,\n  `MailZip` varchar(5) COLLATE utf8_unicode_ci DEFAULT NULL,\n  `MailZipPlus4` varchar(4) COLLATE utf8_unicode_ci DEFAULT NULL,\n  `Filler3` varchar(2) COLLATE utf8_unicode_ci DEFAULT NULL,\n  `MailAddress2` varchar(30) COLLATE utf8_unicode_ci DEFAULT NULL,\n  `MailAddress3` varchar(30) COLLATE utf8_unicode_ci DEFAULT NULL,\n  `MailCounty` varchar(20) COLLATE utf8_unicode_ci DEFAULT NULL,\n  `DateAdded` date DEFAULT NULL,\n  `DateChanged` date DEFAULT NULL,\n  `DistrictCombo` varchar(3) COLLATE utf8_unicode_ci DEFAULT NULL,\n  `ResBuilding` varchar(3) COLLATE utf8_unicode_ci DEFAULT NULL,\n  `MailRRPOBox` varchar(8) COLLATE utf8_unicode_ci DEFAULT NULL,\n  `CombinedStreetAddr` varchar(60) COLLATE utf8_unicode_ci DEFAULT NULL,\n  `ExportDate` date NOT NULL,\n  PRIMARY KEY (`CountyCode`,`RegistrationNbr`)\n) ENGINE=InnoDB DEFAULT CHARSET=utf8;\n\nLOAD DATA INFILE '${unparsedTextFile.canonicalPath}'\nINTO TABLE `VotersTemp`\nLINES TERMINATED BY '\\r\\n'\n( @var1 )\n  SET `CountyCode`=TRIM(SUBSTR(@var1,1,3)),\n  `RegistrationNbr`=TRIM(SUBSTR(@var1,4,8)),\n  `VoterStatus`=TRIM(SUBSTR(@var1,12,1)),\n  `VoterLastName`=TRIM(SUBSTR(@var1,13,20)),\n  `VoterFirstName`=TRIM(SUBSTR(@var1,33,20)),\n  `VoterMiddleMaiden`=TRIM(SUBSTR(@var1,53,20)),\n  `VoterNameSuffix`=TRIM(SUBSTR(@var1,73,3)),\n  `VoterNameTitle`=TRIM(SUBSTR(@var1,76,3)),\n  `ResHouseNbr`=TRIM(SUBSTR(@var1,79,6)),\n  `ResStreetName`=TRIM(SUBSTR(@var1,85,30)),\n  `ResStreetSuffix`=TRIM(SUBSTR(@var1,115,2)),\n  `ResAptUnitNbr`=TRIM(SUBSTR(@var1,117,8)),\n  `ResCityName`=TRIM(SUBSTR(@var1,125,17)),\n  `ResZip`=TRIM(SUBSTR(@var1,142,5)),\n  `ResZipPlus4`=TRIM(SUBSTR(@var1,147,4)),\n  `MidrFlag`=TRIM(SUBSTR(@var1,151,1)),\n  `PollWorker`=TRIM(SUBSTR(@var1,152,1)),\n  `TransactionCode`=TRIM(SUBSTR(@var1,153,1)),\n  `TransactionYearMonth`=TRIM(SUBSTR(@var1,154,6)),\n  `Filler1`=TRIM(SUBSTR(@var1,160,2)),\n  `DateOfBirth`=STR_TO_DATE(SUBSTR(@var1,162,8),'%Y%m%d'),\n  `RegistrationDate`=STR_TO_DATE(SUBSTR(@var1,170,8),'%Y%m%d'),\n  `Race`=TRIM(SUBSTR(@var1,178,1)),\n  `Gender`=TRIM(SUBSTR(@var1,179,1)),\n  `Absentee`=TRIM(SUBSTR(@var1,180,1)),\n  `LandDistrict`=TRIM(SUBSTR(@var1,181,3)),\n  `LandLot`=TRIM(SUBSTR(@var1,184,4)),\n  `OriginalRegDate`=STR_TO_DATE(SUBSTR(@var1,188,8),'%Y%m%d'),\n  `StatusReason`=TRIM(SUBSTR(@var1,196,9)),\n  `Filler2`=TRIM(SUBSTR(@var1,205,5)),\n  `CountyPrecinctId`=TRIM(SUBSTR(@var1,210,5)),\n  `CityPrecinctId`=TRIM(SUBSTR(@var1,215,5)),\n  `CongressionalDistrict`=TRIM(SUBSTR(@var1,220,3)),\n  `SenateDistrict`=TRIM(SUBSTR(@var1,223,3)),\n  `HouseDistrict`=TRIM(SUBSTR(@var1,226,3)),\n  `JudicialDistrict`=TRIM(SUBSTR(@var1,229,3)),\n  `CommDistrict`=TRIM(SUBSTR(@var1,232,3)),\n  `SchoolDistrict`=TRIM(SUBSTR(@var1,235,3)),\n  `CountyDistAName`=TRIM(SUBSTR(@var1,238,13)),\n  `CountyDistAValue`=TRIM(SUBSTR(@var1,251,3)),\n  `CountyDistBName`=TRIM(SUBSTR(@var1,254,13)),\n  `CountyDistBValue`=TRIM(SUBSTR(@var1,267,3)),\n  `MunicipalName`=TRIM(SUBSTR(@var1,270,17)),\n  `MunicipalCode`=TRIM(SUBSTR(@var1,287,3)),\n  `WardCityCouncilName`=TRIM(SUBSTR(@var1,290,13)),\n  `WardCityCouncil`=TRIM(SUBSTR(@var1,303,3)),\n  `CitySchoolDistName`=TRIM(SUBSTR(@var1,306,13)),\n  `CitySchoolDist`=TRIM(SUBSTR(@var1,319,3)),\n  `CityDistAName`=TRIM(SUBSTR(@var1,322,13)),\n  `CityDistAValue`=TRIM(SUBSTR(@var1,335,3)),\n  `CityDistBName`=TRIM(SUBSTR(@var1,338,13)),\n  `CityDistBValue`=TRIM(SUBSTR(@var1,351,3)),\n  `CityDistCName`=TRIM(SUBSTR(@var1,354,13)),\n  `CityDistCValue`=TRIM(SUBSTR(@var1,367,3)),\n  `CityDistDName`=TRIM(SUBSTR(@var1,370,13)),\n  `CityDistDValue`=TRIM(SUBSTR(@var1,383,3)),\n  `DateLastVotedDate`=STR_TO_DATE(SUBSTR(@var1,386,8),'%Y%m%d'),\n  `TypeOfElection`=TRIM(SUBSTR(@var1,394,3)),\n  `PartyLastVoted`=TRIM(SUBSTR(@var1,397,1)),\n  `LastContactDate`=STR_TO_DATE(SUBSTR(@var1,398,8),'%Y%m%d'),\n  `MailHouseNbr`=TRIM(SUBSTR(@var1,406,6)),\n  `MailStreetName`=TRIM(SUBSTR(@var1,412,30)),\n  `MailStreetSuffix`=TRIM(SUBSTR(@var1,442,2)),\n  `MailAptUnitNbr`=TRIM(SUBSTR(@var1,444,8)),\n  `MailCity`=TRIM(SUBSTR(@var1,452,17)),\n  `MailState`=TRIM(SUBSTR(@var1,469,2)),\n  `MailZip`=TRIM(SUBSTR(@var1,471,5)),\n  `MailZipPlus4`=TRIM(SUBSTR(@var1,476,4)),\n  `Filler3`=TRIM(SUBSTR(@var1,480,2)),\n  `MailAddress2`=TRIM(SUBSTR(@var1,482,30)),\n  `MailAddress3`=TRIM(SUBSTR(@var1,512,30)),\n  `MailCounty`=TRIM(SUBSTR(@var1,542,20)),\n  `DateAdded`=STR_TO_DATE(SUBSTR(@var1,562,8),'%Y%m%d'),\n  `DateChanged`=STR_TO_DATE(SUBSTR(@var1,570,8),'%Y%m%d'),\n  `DistrictCombo`=TRIM(SUBSTR(@var1,578,3)),\n  `ResBuilding`=TRIM(SUBSTR(@var1,581,3)),\n  `MailRRPOBox`=TRIM(SUBSTR(@var1,584,8)),\n  `CombinedStreetAddr`=TRIM(SUBSTR(@var1,592,60)),\n  `ExportDate`=STR_TO_DATE('${modificationTime}','%Y%m%d');\n\n-- CREATE TABLE gpga.Voters SELECT * FROM VotersTemp;\n\nINSERT INTO gpga.Voters SELECT * FROM VotersTemp;\n\nDROP TEMPORARY TABLE IF EXISTS VotersTemp;\n\n\n\"\"\"\nsql.execute(importSQL)\nreturn [\n\t[\n\t\timportFile: unparsedTextFile.canonicalPath,\n\t\tsnapshotDate: modificationTime\n\t]\n]\n",
  "class": "edu.usf.RuleChains.Groovy"
}
